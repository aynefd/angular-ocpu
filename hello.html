<!DOCTYPE html>
<html>
  <head>
    <title>Hello</title>
    <style>
      #output{
        height: 80px;
        width: 500px;
        border: 1px solid gray;
        padding: 3px;
      }
    </style>
  </head>
  <body ng-app="app" ng-controller="MainCtrl">
    <h1>Hello, world!</h1>

    <b>Your name: </b>
    <input ng-model="model.name" type="text">

    <button ng-click="submit()"
            ng-disabled="model.submisionInProgress"
            type="button">Submit to server!</button>

    <p id="output">{{model.message}}</p>

    <p>
      This is a basic JSON RPC call to OpenCPU. We use <tt>$ocpu.rpc</tt> from the
      <tt>angular-ocpu.js</tt> library to call the R function called <tt>hello</tt>
      included in the <a href="https://github.com/opencpu/appdemo">appdemo</a> R package.
    </p>

    <p>Have a look at the HTML source code! Some things to notice:</p>
    <ul>
      <li>We can always see the source code of the R function using the API, e.g
         <a href="https://demo.ocpu.io/appdemo/R/hello/print">here</a>.
      </li>
      <li>If the R function has a manual page, it we can find it <a href="https://demo.ocpu.io/appdemo/man/hello/text">here</a></li>
      <li>When the name field is empty, the R function raises an error. Notice how we deal with this in javascript.</li>
    </ul>

    <script src="js/angular-1.3.9.js"></script>
    <script src="js/angular-ocpu.js"></script>
    <script>
      // set the module
      angular.module('app', ["opencpu"]);

      // get the module
      angular.module('app').controller('MainCtrl', function MainCtrl ($scope, $ocpu) {

        $scope.model = {
          submisionInProgress: false,
          name: "",
          message: ""
        };

        $ocpu.seturl("//demo.ocpu.io/appdemo/R");

        $scope.submit = function () {
          var args = {myname : $scope.model.name},
            req = $ocpu.rpc("hello", args)
              .then(function (output) {
                $scope.model.message = output.message[0];
                $scope.model.submisionInProgress = false;
              }, alert); // Just pass the reason right to alert when an error occurs

            $scope.model.submisionInProgress = true;
        };
      });
    </script>
  </body>
</html>
